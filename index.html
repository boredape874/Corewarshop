<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ì–´ êµ­ê°€ì „ìŸ í›„ì›í…œ ìƒì  (Toss Style)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì„¤ì • -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap">
    <style>
        /* Toss ìŠ¤íƒ€ì¼: ê¹”ë”í•œ ë°°ê²½, Inter í°íŠ¸ ì‚¬ìš© */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9; /* ì•„ì£¼ ë¯¸ì„¸í•œ íšŒìƒ‰ */
            transition: background-color 0.3s, color 0.3s;
        }
        /* ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .dark body { background-color: #1a1a2e; }
        .dark .card-bg { background-color: #2c2c45; }
        .dark .text-primary { color: #f7f7f9; }
        .dark .btn-primary { background-color: #5b5b9c; }
        .dark .btn-primary:hover { background-color: #6e6ee0; }
        .dark input, .dark textarea, .dark select { background-color: #3f3f5a; border-color: #555577; }
        
        /* í°íŠ¸ í¬ê¸° ë° ê°„ê²© ì¡°ì •ìœ¼ë¡œ ëª¨ë˜í•¨ ê°•ì¡° */
        .header-text { font-size: 2.5rem; line-height: 1.1; font-weight: 800; }
        
        /* ìŠ¤í¬ë¡¤ ì‹œ ìƒë‹¨ ê·¸ë¦¼ì */
        .scrolled-header { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); }
    </style>
    
    <!-- Firebase SDK (í•„ìˆ˜) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, setDoc, addDoc, updateDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('Debug');

        // ====== Global Configuration and State ======

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'core-war-shop';
        
        // ğŸš¨ğŸš¨ğŸš¨ ì¤‘ìš”! GitHub Pages ë°°í¬ ì‹œ ì´ ë¶€ë¶„ì„ ì‚¬ìš©ìë‹˜ì˜ ì‹¤ì œ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤. ğŸš¨ğŸš¨ğŸš¨
        // YOUR_FIREBASE_CONFIG_HEREë¥¼ ë³µì‚¬í•œ ì‹¤ì œ Firebase Config ê°ì²´ë¡œ ëŒ€ì²´í•˜ì„¸ìš”.
        const EXTERNAL_FIREBASE_CONFIG = { 
            // ì˜ˆì‹œ: apiKey: "AIzaSy...", authDomain: "my-project-1234.firebaseapp.com", ...
            projectId: 'default-project' // í˜„ì¬ëŠ” ë”ë¯¸ì…ë‹ˆë‹¤. ì´ ì¤„ì„ í¬í•¨í•˜ì—¬ ì „ì²´ë¥¼ êµì²´í•˜ì„¸ìš”.
        };
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : EXTERNAL_FIREBASE_CONFIG;
        
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // êµ¬ë§¤í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë™í•  URL
        const KAKAO_CHAT_URL = "http://pf.kakao.com/_VHjxin/chat";
        
        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
        const ADMIN_PASSWORD = "1818"; 

        let db;
        let auth;
        let currentUserId = null;
        let isAdmin = false;

        // Reactive State
        window.shopState = {
            products: [],
            categories: [],
            tags: [],
            selectedCategory: 'all',
            isModalOpen: false,
            isLoginModalOpen: false,
            editingProduct: null,
            error: null
        };
        
        // ====== Path Definitions ======
        
        const getProductsCollectionRef = () => collection(db, `artifacts/${appId}/public/data/products`);
        const getConfigDocRef = () => doc(db, `artifacts/${appId}/public/data/settings`, 'config');
        
        // ====== Initialization and Auth ======

        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                await setPersistence(auth, browserSessionPersistence);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                    } else {
                        currentUserId = crypto.randomUUID();
                    }
                    document.getElementById('current-user-id').textContent = currentUserId;
                    startDataListeners();
                    if (isAdmin) {
                        document.getElementById('admin-login-btn').classList.add('hidden');
                        document.getElementById('admin-logout-btn').classList.remove('hidden');
                        renderAdminDashboard();
                    }
                });

            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                // Firebase ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
                showNotification("ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨. ì„¤ì •(Config)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.", 'error');
            }
        }
        
        // ====== Data Listener (Real-time Fetch) ======

        function startDataListeners() {
            if (!db) return;

            // 1. ìƒí’ˆ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
            onSnapshot(getProductsCollectionRef(), (snapshot) => {
                const products = [];
                snapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                window.shopState.products = products;
                renderShop();
            }, (error) => {
                console.error("ìƒí’ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
                showNotification("ìƒí’ˆ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨.", 'error');
            });

            // 2. ì„¤ì • ë°ì´í„° (ì¹´í…Œê³ ë¦¬, íƒœê·¸) ë¦¬ìŠ¤ë„ˆ
            onSnapshot(getConfigDocRef(), (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    window.shopState.categories = data.categories || [];
                    window.shopState.tags = data.tags || [];
                } else {
                    // ìµœì´ˆ ì‹¤í–‰ ì‹œ ê¸°ë³¸ ì„¤ì • ë¬¸ì„œ ìƒì„±
                    setDoc(getConfigDocRef(), { categories: ['ê¸°ë³¸', 'ì´ë²¤íŠ¸'], tags: ['HOT', 'NEW'] });
                }
                renderShop();
                if (isAdmin) renderAdminDashboard();
            }, (error) => {
                console.error("ì„¤ì • ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error);
            });
        }
        
        // ====== Admin Management Functions ======
        
        function getFormData(form) {
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            data.tags = formData.getAll('tags');
            data.category = data.category || window.shopState.categories[0] || 'ê¸°ë³¸';
            return data;
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }
        
        window.saveProduct = async (event) => {
            event.preventDefault();
            if (!isAdmin) return showNotification("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
            if (!db) return showNotification("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');

            const form = event.target;
            const data = getFormData(form);
            const imageFile = form.querySelector('#product-image').files[0];
            const productId = window.shopState.editingProduct ? window.shopState.editingProduct.id : null;

            try {
                showNotification("ìƒí’ˆ ì •ë³´ë¥¼ ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...", 'loading');

                if (imageFile) {
                    if (imageFile.size > 1024 * 1024) { // 1MB ì œí•œ
                        showNotification("ì´ë¯¸ì§€ í¬ê¸°ëŠ” 1MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                        return;
                    }
                    data.image = await fileToBase64(imageFile);
                } else if (productId && window.shopState.editingProduct && window.shopState.editingProduct.image) {
                    data.image = window.shopState.editingProduct.image;
                } else {
                    // Placeholder (Toss-like minimal card)
                    data.image = `https://placehold.co/400x300/e6e7eb/313180?text=${encodeURIComponent(data.title.substring(0, 10))}%20No%20Image`;
                }
                
                const productToSave = {
                    title: data.title,
                    content: data.content,
                    category: data.category,
                    tags: data.tags || [],
                    image: data.image,
                    createdAt: productId ? window.shopState.editingProduct.createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (productId) {
                    await updateDoc(doc(getProductsCollectionRef(), productId), productToSave);
                    showNotification("ìƒí’ˆì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                } else {
                    await addDoc(getProductsCollectionRef(), productToSave);
                    showNotification("ìƒí’ˆì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                }

                closeModal();
                window.shopState.editingProduct = null;
            } catch (error) {
                console.error("ìƒí’ˆ ì €ì¥ ì˜¤ë¥˜:", error);
                showNotification(`ìƒí’ˆ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        };
        
        window.deleteProduct = async (productId) => {
            if (!isAdmin) return showNotification("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
             if (!db) return showNotification("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');
            
            showConfirmationModal("ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", async () => {
                try {
                    await deleteDoc(doc(getProductsCollectionRef(), productId));
                    showNotification("ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                    closeModal('confirm-modal');
                } catch (error) {
                    console.error("ìƒí’ˆ ì‚­ì œ ì˜¤ë¥˜:", error);
                    showNotification(`ìƒí’ˆ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                }
            });
        };

        window.saveConfig = async (configType) => {
            if (!isAdmin) return showNotification("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
            if (!db) return showNotification("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');
            
            const inputId = configType === 'category' ? 'new-category-name' : 'new-tag-name';
            const newName = document.getElementById(inputId).value.trim();

            if (!newName) return showNotification("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'warning');

            try {
                const currentConfig = { categories: [...window.shopState.categories], tags: [...window.shopState.tags] };
                
                let updated = false;
                if (configType === 'category' && !currentConfig.categories.includes(newName)) {
                    currentConfig.categories.push(newName);
                    updated = true;
                } else if (configType === 'tag' && !currentConfig.tags.includes(newName)) {
                    currentConfig.tags.push(newName);
                    updated = true;
                }
                
                if (updated) {
                    await setDoc(getConfigDocRef(), currentConfig);
                    document.getElementById(inputId).value = '';
                    showNotification(`${configType === 'category' ? 'ì¹´í…Œê³ ë¦¬' : 'íƒœê·¸'}ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    showNotification("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.", 'warning');
                }
                
            } catch (error) {
                console.error("ì„¤ì • ì €ì¥ ì˜¤ë¥˜:", error);
                showNotification("ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.", 'error');
            }
        };
        
        window.deleteConfig = async (configType, name) => {
             if (!isAdmin) return showNotification("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
             if (!db) return showNotification("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');
             
             const currentConfig = { categories: [...window.shopState.categories], tags: [...window.shopState.tags] };
             
             try {
                if (configType === 'category') {
                     currentConfig.categories = currentConfig.categories.filter(c => c !== name);
                } else if (configType === 'tag') {
                     currentConfig.tags = currentConfig.tags.filter(t => t !== name);
                }
                
                await setDoc(getConfigDocRef(), currentConfig);
                showNotification(`${configType === 'category' ? 'ì¹´í…Œê³ ë¦¬' : 'íƒœê·¸'}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
             } catch (error) {
                console.error("ì„¤ì • ì‚­ì œ ì˜¤ë¥˜:", error);
                showNotification("ì„¤ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.", 'error');
             }
        };
        
        // ====== Purchase Logic (Updated) ======
        
        // ì´ì œ purchaseItemì€ ì•Œë¦¼ë§Œ í‘œì‹œí•˜ê³ , ì‹¤ì œ ì´ë™ì€ HTML <a> íƒœê·¸ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        window.purchaseItem = (productName) => {
            showNotification(`'${productName}' êµ¬ë§¤ë¥¼ ìœ„í•´ ì¹´ì¹´ì˜¤í†¡ ì±„íŒ…ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`, 'info');
        };
        
        // ====== Admin Login Logic (Demo) ======
        
        window.openLoginModal = () => {
             window.shopState.isLoginModalOpen = true;
             renderLoginModal();
        };
        
        window.closeLoginModal = () => {
             window.shopState.isLoginModalOpen = false;
             renderLoginModal();
        };

        window.adminLogin = (event) => {
            event.preventDefault();
            const password = document.getElementById('admin-password').value;

            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                window.closeLoginModal();
                renderAdminDashboard();
                document.getElementById('admin-login-btn').classList.add('hidden');
                document.getElementById('admin-logout-btn').classList.remove('hidden');
                showNotification("ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤.", 'success');
                renderShop();
            } else {
                showNotification("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.", 'error');
                document.getElementById('admin-password').value = '';
            }
        };
        
        window.adminLogout = () => {
            isAdmin = false;
            renderAdminDashboard();
            document.getElementById('admin-login-btn').classList.remove('hidden');
            document.getElementById('admin-logout-btn').classList.add('hidden');
            showNotification("ë¡œê·¸ì•„ì›ƒí–ˆìŠµë‹ˆë‹¤.", 'info');
            renderShop();
        };

        // ====== Modal Functions ======
        
        window.openModal = (product = null) => {
            if (!isAdmin) return showNotification("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
            window.shopState.editingProduct = product;
            window.shopState.isModalOpen = true;
            renderProductModal();
        };

        window.closeModal = (id = 'product-modal') => {
            window.shopState.isModalOpen = false;
            window.shopState.editingProduct = null;
            
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('hidden');
        };

        // ====== UI Rendering Functions ======
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            let bgColor;
            
            switch (type) {
                case 'success': bgColor = 'bg-blue-600'; break; /* Toss-like Blue */
                case 'error': bgColor = 'bg-red-600'; break;
                case 'warning': bgColor = 'bg-yellow-600'; break;
                case 'loading': bgColor = 'bg-gray-600'; break;
                default: bgColor = 'bg-gray-500';
            }
            
            notification.textContent = message;
            notification.className = `fixed bottom-4 right-4 p-4 rounded-xl shadow-2xl text-white transition-opacity duration-300 z-[100] ${bgColor}`;
            notification.classList.remove('opacity-0', 'hidden');

            if (type !== 'loading') {
                setTimeout(() => {
                    notification.classList.add('opacity-0');
                    setTimeout(() => notification.classList.add('hidden'), 300);
                }, 3000);
            }
        }
        
        function showConfirmationModal(message, onConfirm) {
            const modalHtml = `
                <div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="bg-white card-bg p-8 rounded-3xl shadow-2xl max-w-sm w-full transition-all">
                        <h3 class="text-xl font-bold mb-4 text-red-600 dark:text-red-400">ì‚­ì œ í™•ì¸</h3>
                        <p class="text-gray-700 dark:text-gray-300 mb-8">${message}</p>
                        <div class="flex justify-end space-x-3">
                            <button onclick="closeModal('confirm-modal')" class="px-4 py-3 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition">ì·¨ì†Œ</button>
                            <button id="confirm-modal-btn" class="px-4 py-3 text-white bg-red-600 rounded-xl hover:bg-red-700 transition font-semibold">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal-container').innerHTML += modalHtml;
            document.getElementById('confirm-modal-btn').onclick = onConfirm;
        }

        /**
         * ë©”ì¸ ìƒì  í˜ì´ì§€ ë Œë”ë§
         */
        function renderShop() {
            const productsContainer = document.getElementById('products-container');
            const categoryNav = document.getElementById('category-nav');
            const { products, categories, selectedCategory } = window.shopState;
            
            if (!productsContainer) return;
            
            // 1. ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§ (ì¹© ìŠ¤íƒ€ì¼)
            const categoryHtml = `
                <button onclick="window.shopState.selectedCategory = 'all'; renderShop();" class="
                    ${selectedCategory === 'all' 
                        ? 'bg-indigo-600 text-white' 
                        : 'bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300'} 
                    px-4 py-2 rounded-full font-semibold text-sm hover:opacity-80 transition
                ">ì „ì²´</button>
                ${categories.map(cat => {
                    const isActive = selectedCategory === cat;
                    return `
                        <button onclick="window.shopState.selectedCategory = '${cat}'; renderShop();" class="
                            ${isActive
                                ? 'bg-indigo-600 text-white' 
                                : 'bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300'} 
                            px-4 py-2 rounded-full font-semibold text-sm hover:opacity-80 transition
                        ">${cat}</button>
                    `;
                }).join('')}
            `;
            categoryNav.innerHTML = categoryHtml;
            
            // 2. ìƒí’ˆ ì¹´ë“œ ë Œë”ë§
            const filteredProducts = selectedCategory === 'all' 
                ? products 
                : products.filter(p => p.category === selectedCategory);
                
            if (filteredProducts.length === 0) {
                 productsContainer.innerHTML = `<div class="md:col-span-3 text-center py-20 text-xl font-medium text-gray-500 dark:text-gray-400">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                 return;
            }

            productsContainer.innerHTML = filteredProducts.map(product => `
                <div class="bg-white card-bg rounded-3xl shadow-xl overflow-hidden flex flex-col transition transform hover:shadow-2xl hover:scale-[1.01]">
                    <div class="w-full h-48 bg-gray-100 dark:bg-gray-700 overflow-hidden relative">
                        <!-- ì´ë¯¸ì§€ -->
                        <img src="${product.image}" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e6e7eb/313180?text=${encodeURIComponent(product.title.substring(0, 10))}%20No%20Image';" 
                             alt="${product.title}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                        
                        <!-- ì¹´í…Œê³ ë¦¬ íƒœê·¸ -->
                        <div class="absolute top-3 left-3 bg-white dark:bg-gray-800 text-xs font-bold text-indigo-600 dark:text-indigo-400 px-3 py-1 rounded-full shadow-md">
                            ${product.category}
                        </div>
                    </div>
                    
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-extrabold mb-2 dark:text-white">${product.title}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm mb-4 flex-grow">${product.content}</p>
                        
                        <!-- íƒœê·¸ ëª©ë¡ -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${(product.tags || []).map(tag => `<span class="text-xs text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">${tag}</span>`).join('')}
                        </div>

                        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                        <div class="flex ${isAdmin ? 'justify-between' : 'justify-center'} items-center mt-auto pt-4 border-t border-gray-100 dark:border-gray-700">
                            <!-- êµ¬ë§¤ ë²„íŠ¼ (ì¼ë°˜ ì‚¬ìš©ì) - <a> íƒœê·¸ë¡œ ì•ˆì •ì ì¸ ìƒˆ íƒ­ ì—´ê¸° êµ¬í˜„ -->
                            <a href="${KAKAO_CHAT_URL}" target="_blank" onclick="purchaseItem('${product.title}')"
                                class="text-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:bg-indigo-700 transition transform hover:scale-[1.01] ${isAdmin ? 'w-full mr-2' : 'w-full'}">
                                êµ¬ë§¤í•˜ê¸° (ì¹´í†¡ ë¬¸ì˜)
                            </a>
                            
                            <!-- ê´€ë¦¬ì ë²„íŠ¼ -->
                            ${isAdmin ? `
                                <div class="flex space-x-2 ml-3">
                                    <button onclick="openModal(${JSON.stringify(product).replace(/"/g, '&quot;')})" 
                                            class="p-3 bg-yellow-500 text-white rounded-xl hover:bg-yellow-600 transition text-sm font-semibold">ìˆ˜ì •</button>
                                    <button onclick="deleteProduct('${product.id}')" 
                                            class="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition text-sm font-semibold">ì‚­ì œ</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        /**
         * ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë Œë”ë§
         */
        function renderAdminDashboard() {
            const adminDashboard = document.getElementById('admin-dashboard');
            
            if (!adminDashboard) return;

            if (isAdmin) {
                adminDashboard.classList.remove('hidden');
            } else {
                adminDashboard.classList.add('hidden');
                return;
            }
            
            const { categories, tags, products } = window.shopState;

            // ì¹´í…Œê³ ë¦¬/íƒœê·¸ ê´€ë¦¬ UI ë Œë”ë§
            const configHtml = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                    <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ -->
                    <div class="bg-white card-bg p-6 rounded-2xl shadow-lg">
                        <h4 class="text-xl font-bold mb-4 dark:text-white">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ (${categories.length})</h4>
                        <form onsubmit="event.preventDefault(); saveConfig('category');" class="flex gap-2 mb-4">
                            <input type="text" id="new-category-name" placeholder="ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„" class="flex-grow p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white text-sm">
                            <button type="submit" class="p-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition font-semibold text-sm">ì¶”ê°€</button>
                        </form>
                        <div class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-1">
                            ${categories.map(cat => `
                                <div class="flex items-center bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300 px-3 py-1 rounded-full text-sm font-medium">
                                    ${cat}
                                    <button onclick="deleteConfig('category', '${cat}')" class="ml-2 text-red-500 hover:text-red-700 transition">Ã—</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- íƒœê·¸ ê´€ë¦¬ -->
                    <div class="bg-white card-bg p-6 rounded-2xl shadow-lg">
                        <h4 class="text-xl font-bold mb-4 dark:text-white">íƒœê·¸ ê´€ë¦¬ (${tags.length})</h4>
                        <form onsubmit="event.preventDefault(); saveConfig('tag');" class="flex gap-2 mb-4">
                            <input type="text" id="new-tag-name" placeholder="ìƒˆ íƒœê·¸ ì´ë¦„" class="flex-grow p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white text-sm">
                            <button type="submit" class="p-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition font-semibold text-sm">ì¶”ê°€</button>
                        </form>
                        <div class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-1">
                            ${tags.map(tag => `
                                <div class="flex items-center bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300 px-3 py-1 rounded-full text-sm font-medium">
                                    ${tag}
                                    <button onclick="deleteConfig('tag', '${tag}')" class="ml-2 text-red-500 hover:text-red-700 transition">Ã—</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- ìƒí’ˆ ëª©ë¡ ê´€ë¦¬ -->
                <div class="bg-white card-bg p-6 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-2xl font-bold dark:text-white">ì „ì²´ ìƒí’ˆ ëª©ë¡ (${products.length})</h4>
                        <button onclick="openModal()" class="px-4 py-3 bg-indigo-600 text-white rounded-xl shadow-md hover:bg-indigo-700 transition font-semibold">
                            + ìƒˆ ìƒí’ˆ ë“±ë¡
                        </button>
                    </div>
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        ${products.map(product => `
                            <div class="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-800">
                                <div class="flex-grow min-w-0">
                                    <p class="font-semibold dark:text-white truncate">${product.title}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${product.category} | ${product.tags.join(', ')}</p>
                                </div>
                                <div class="flex space-x-2 ml-4 flex-shrink-0">
                                    <button onclick="openModal(${JSON.stringify(product).replace(/"/g, '&quot;')})" 
                                            class="p-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition text-xs font-semibold">ìˆ˜ì •</button>
                                    <button onclick="deleteProduct('${product.id}')" 
                                            class="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-xs font-semibold">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            adminDashboard.innerHTML = configHtml;
        }

        /**
         * ìƒí’ˆ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ ë Œë”ë§
         */
        function renderProductModal() {
            const container = document.getElementById('modal-container');
            if (!container) return;
            
            const product = window.shopState.editingProduct;
            const isEditing = !!product;
            const { categories, tags } = window.shopState;

            const formHtml = `
                <div id="product-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 ${window.shopState.isModalOpen ? '' : 'hidden'}">
                    <div class="bg-white card-bg p-8 rounded-3xl shadow-2xl max-w-2xl w-full max-h-[95vh] overflow-y-auto transition-all duration-300">
                        <div class="flex justify-between items-center mb-6 border-b pb-3 border-gray-100 dark:border-gray-700">
                            <h3 class="text-2xl font-extrabold text-indigo-600 dark:text-indigo-400">${isEditing ? 'ìƒí’ˆ ìˆ˜ì •' : 'ìƒˆ ìƒí’ˆ ë“±ë¡'}</h3>
                            <button onclick="closeModal()" class="text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white text-3xl leading-none">Ã—</button>
                        </div>
                        
                        <form onsubmit="saveProduct(event)">
                            <!-- ì œëª© -->
                            <div class="mb-4">
                                <label for="product-title" class="block text-sm font-semibold mb-2 dark:text-gray-300">ìƒí’ˆ ì œëª©</label>
                                <input type="text" id="product-title" name="title" required value="${product?.title || ''}"
                                       class="w-full p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <!-- ë‚´ìš© -->
                            <div class="mb-4">
                                <label for="product-content" class="block text-sm font-semibold mb-2 dark:text-gray-300">ìƒí’ˆ ë‚´ìš©</label>
                                <textarea id="product-content" name="content" rows="3" required
                                          class="w-full p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white">${product?.content || ''}</textarea>
                            </div>
                            
                            <!-- ì¹´í…Œê³ ë¦¬ -->
                            <div class="mb-4">
                                <label for="product-category" class="block text-sm font-semibold mb-2 dark:text-gray-300">ì¹´í…Œê³ ë¦¬ ì„¤ì •</label>
                                <select id="product-category" name="category" required 
                                        class="w-full p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white">
                                    ${categories.map(cat => `<option value="${cat}" ${product?.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                </select>
                            </div>
                            
                            <!-- íƒœê·¸ -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold mb-2 dark:text-gray-300">íƒœê·¸ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
                                <div class="flex flex-wrap gap-2 p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700">
                                    ${tags.map(tag => {
                                        const isSelected = product?.tags?.includes(tag) || false;
                                        return `
                                            <label class="flex items-center space-x-2 cursor-pointer bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full">
                                                <input type="checkbox" name="tags" value="${tag}" ${isSelected ? 'checked' : ''}
                                                       class="rounded text-indigo-600 dark:text-indigo-400 focus:ring-indigo-500">
                                                <span class="text-sm dark:text-gray-300">${tag}</span>
                                            </label>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            
                            <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                            <div class="mb-6">
                                <label for="product-image" class="block text-sm font-semibold mb-2 dark:text-gray-300">ìƒí’ˆ ì´ë¯¸ì§€ (ìµœëŒ€ 1MB ê¶Œì¥)</label>
                                <input type="file" id="product-image" name="image" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400
                                       file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-semibold
                                       file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition">
                                ${isEditing && product.image ? `<p class="text-xs mt-2 dark:text-gray-400">í˜„ì¬ ì´ë¯¸ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ë³€ê²½í•˜ë ¤ë©´ ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>` : ''}
                            </div>
                            
                            <!-- ì €ì¥ ë²„íŠ¼ -->
                            <button type="submit" class="w-full py-4 btn-primary bg-indigo-600 text-white font-extrabold rounded-2xl shadow-lg hover:bg-indigo-700 transition transform hover:scale-[1.005]">
                                ${isEditing ? 'ìƒí’ˆ ìˆ˜ì • ì™„ë£Œ' : 'ìƒˆ ìƒí’ˆ ë“±ë¡'}
                            </button>
                        </form>
                    </div>
                </div>
            `;
            container.innerHTML = formHtml;
        }

        /**
         * ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ ë Œë”ë§
         */
        function renderLoginModal() {
            const container = document.getElementById('login-modal-container');
            if (!container) return;

            const modalHtml = `
                <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 ${window.shopState.isLoginModalOpen ? '' : 'hidden'}">
                    <div class="bg-white card-bg p-8 rounded-3xl shadow-2xl max-w-sm w-full transition-all duration-300">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-extrabold text-indigo-600 dark:text-indigo-400">ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                            <button onclick="closeLoginModal()" class="text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white text-3xl leading-none">Ã—</button>
                        </div>
                        
                        <form onsubmit="adminLogin(event)">
                            <div class="mb-6">
                                <label for="admin-password" class="block text-sm font-semibold mb-2 dark:text-gray-300">ë¹„ë°€ë²ˆí˜¸</label>
                                <input type="password" id="admin-password" required
                                       class="w-full p-3 border border-gray-200 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white">
                            </div>
                            
                            <button type="submit" class="w-full py-4 btn-primary bg-indigo-600 text-white font-extrabold rounded-xl shadow-lg hover:bg-indigo-700 transition transform hover:scale-[1.005]">
                                ë¡œê·¸ì¸
                            </button>
                        </form>
                    </div>
                </div>
            `;
            container.innerHTML = modalHtml;
        }

        // ====== Main Application Entry Point ======

        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            window.addEventListener('scroll', () => {
                const header = document.querySelector('header');
                if (window.scrollY > 10) {
                    header.classList.add('scrolled-header');
                } else {
                    header.classList.remove('scrolled-header');
                }
            });
        });
        
    </script>

    <!-- UI Structure -->
    <div class="min-h-screen">
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë° í—¤ë” -->
        <header class="bg-white dark:bg-gray-800 sticky top-0 z-40 transition-shadow">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-5 flex justify-between items-center">
                <h1 class="header-text text-indigo-600 dark:text-indigo-400 font-extrabold">CORE SHOP</h1>
                <div class="flex items-center space-x-4">
                    <!-- ìœ ì € ID í‘œì‹œ (ë””ë²„ê·¸ìš©) -->
                    <p class="text-xs text-gray-400 hidden sm:block">ID: <span id="current-user-id">...</span></p>
                    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œ ë…¸ì¶œ) -->
                    <button onclick="adminLogout()" id="admin-logout-btn" 
                            class="px-3 py-1 bg-red-500 text-white rounded-full shadow-md hover:bg-red-600 transition text-sm hidden">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                    <!-- ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ (ì˜µì…˜) -->
                    <!-- <button onclick="toggleDarkMode()" class="text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition">ğŸŒ™</button> -->
                </div>
            </div>
        </header>

        <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
            
            <h2 class="text-4xl font-extrabold text-center mb-10 dark:text-white">
                ì½”ì–´ êµ­ê°€ì „ìŸ í›„ì› ì•„ì´í…œ
            </h2>
            <p class="text-center text-lg text-gray-500 dark:text-gray-400 mb-12">
                í›„ì›í•´ ì£¼ì‹  ê¸ˆì•¡ì€ ì„œë²„ ìœ ì§€ ë° ê°œë°œì— ì‚¬ìš©ë©ë‹ˆë‹¤. ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.
            </p>

            <!-- ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav id="category-nav" class="flex flex-wrap justify-center gap-3 mb-16"></nav>

            <!-- ìƒí’ˆ ëª©ë¡ ì»¨í…Œì´ë„ˆ -->
            <section id="products-container" class="grid grid-cols-1 md:grid-cols-2 gap-8"></section>

            <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (isAdmin=trueì¼ ë•Œ í‘œì‹œ) -->
            <section id="admin-dashboard" class="mt-20 border-t-2 border-dashed border-gray-300 dark:border-gray-700 pt-10 hidden">
                <div class="flex justify-between items-center mb-10">
                    <h2 class="text-3xl font-extrabold dark:text-white">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
                </div>
                <!-- ì—¬ê¸°ì— configHtml + productListHtmlì´ ë Œë”ë§ë¨ -->
            </section>
            
        </main>
        
        <!-- í•˜ë‹¨ ê´€ë¦¬ì ë¡œê·¸ì¸ ë²„íŠ¼ (ì‘ê³  ìˆ¨ê²¨ì§„ í˜•íƒœ) -->
        <div class="py-10 text-center">
             <button onclick="openLoginModal()" id="admin-login-btn" 
                     class="text-xs text-gray-400 dark:text-gray-600 hover:text-indigo-600 dark:hover:text-indigo-400 transition underline">
                ê´€ë¦¬ì ëª¨ë“œ
            </button>
        </div>

    </div>

    <!-- ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ (ê´€ë¦¬ì ìƒí’ˆ ëª¨ë‹¬ ë° í™•ì¸ ëª¨ë‹¬) -->
    <div id="modal-container"></div>
    
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ -->
    <div id="login-modal-container"></div>

    <!-- ì•Œë¦¼ ë©”ì‹œì§€ (Toast) -->
    <div id="notification" class="fixed bottom-4 right-4 p-3 rounded-lg shadow-lg text-white opacity-0 hidden transition-opacity duration-300 z-[100]"></div>

</body>
</html>

